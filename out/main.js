// Generated by CoffeeScript 1.8.0
(function() {
  var image_loader, render_cards, render_comments, render_likes;

  console.log('ajax');

  $.ajax('https://api.instagram.com/v1/users/self/feed?access_token=435677321.03fd3ce.41289f7b8ed14d9180438b99f8e38b77', {
    type: 'GET',
    dataType: 'jsonp',
    jsonpCallback: 'callback',
    error: function(jqXHR, textStatus, errorThrown) {
      return $('body').append("AJAX Error: " + textStatus);
    },
    success: function(data, textStatus, jqXHR) {
      var feed;
      feed = document.getElementById('instafeed');
      return render_cards(image_loader(data, feed), feed);
    }
  });

  image_loader = function(data, feed) {
    var card_hash, card_objects, post, _i, _len, _ref;
    card_objects = [];
    _ref = data.data;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      post = _ref[_i];
      card_hash = {};
      card_hash['img_url'] = post.images.standard_resolution.url;
      card_hash['post_url'] = post.link;
      if (post.caption != null) {
        card_hash['text'] = post.caption.text;
      }
      if (post.comments.count > 0) {
        card_hash['comments'] = post.comments;
      }
      if (post.likes.count > 0) {
        card_hash['likes'] = post.likes;
      }
      card_objects.push(card_hash);
    }
    console.log(card_objects);
    return card_objects;
  };

  render_cards = function(card_array, target_div) {
    var card, card_template, comments_box, content, html, img, likes_bar, _i, _len;
    html = "";
    for (_i = 0, _len = card_array.length; _i < _len; _i++) {
      card = card_array[_i];
      card_template = "";
      img = "<div class= 'image'>" + "<img src=" + card.img_url + "></div>";
      content = "";
      if (card.likes != null) {
        content = render_likes(card.likes.data);
      } else {
        content = "No one likes you";
      }
      likes_bar = "<div class='likes'><div class='heart'> &nbsp </div>" + content + "</div>";
      if (card.comments != null) {
        content = render_comments(card.comments.data);
      } else {
        content = "<div class= 'no-friends'> No one found you interesting enough to talk to. </div>";
      }
      comments_box = "<div class= 'comments'>" + content + "<input class= 'words' type='text' placeholder='Write a comment...'></div>";
      card_template = "<div class= 'card'>" + img + likes_bar + comments_box + "</div>";
      html += card_template + "<br><br>";
    }
    html = "<div class= cardbar>" + html + "</div>";
    return target_div.innerHTML = html;
  };

  render_comments = function(comments) {
    var comment, comment_html, _i, _len;
    comment_html = "";
    for (_i = 0, _len = comments.length; _i < _len; _i++) {
      comment = comments[_i];
      comment_html += "<div class= 'single-comment'><img class= 'profile-pic' src='" + comment.from.profile_picture + "'>" + "<div class= 'highlighted-text'>" + comment.from.username + "</div>" + comment.text + "</div>";
    }
    return comment_html;
  };

  render_likes = function(likes) {
    var addendum, last_few, like, usernames, _i, _len;
    usernames = "";
    addendum = "";
    if (likes.length > 3) {
      last_few = likes.slice(Math.max(likes.length - 3, 1));
      addendum = "and " + (likes.length - 3) + " others";
    } else {
      last_few = likes;
    }
    for (_i = 0, _len = likes.length; _i < _len; _i++) {
      like = likes[_i];
      usernames += "<div class= 'highlighted-text'>" + like.username + ", </div> ";
    }
    addendum += " like this";
    usernames = "<div class= 'user-list'>" + usernames + addendum + "</div>";
    return usernames;
  };

}).call(this);
